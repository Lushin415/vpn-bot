package bot

import (
	"log"

	"github.com/robfig/cron/v3"
	"vpn-bot/internal/services"
)

// InitCronJobs –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º cron.
func InitCronJobs() {
	c := cron.New()

	// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã.
	_, err := c.AddFunc("*/2 * * * *", func() {
		log.Println("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π...")
		services.CheckPendingPayments()
	})
	if err != nil {
		log.Printf("üî¥ –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π: %v", err)
	}

	// 2. –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø–æ–¥–ø–∏—Å–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ 10:00 —É—Ç—Ä–∞).
	_, err = c.AddFunc("0 10 * * *", func() {
		log.Println("üì¢ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø–æ–¥–ø–∏—Å–∫–µ...")
		services.SendSubscriptionReminders()
	})
	if err != nil {
		log.Printf("üî¥ –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: %v", err)
	}

	// 3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ 03:00 —É—Ç—Ä–∞.
	// üî¥ ! –ï—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è MonitorServers, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞–¥–∞—á—É.
	/*
		_, err = c.AddFunc("0 3 * * *", func() {
			log.Println("üì° –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤...")
			services.MonitorServers()
		})
		if err != nil {
			log.Printf("üî¥ –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤: %v", err)
		}
	*/

	c.Start()
	log.Println("‚úÖ Cron –∑–∞–¥–∞—á–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω—ã!")
}
